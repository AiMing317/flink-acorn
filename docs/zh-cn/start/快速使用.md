### 快速使用

> [需要提前安装flink-acorn](/zh-cn/install/快速安装.md)

?> 参考案例: `https://github.com/ispong/flink-acorn/tree/main/examples/acorn-demo`

##### 添加依赖

[![Maven Version](https://img.shields.io/maven-central/v/com.isxcode.acorn/acorn-common)](https://search.maven.org/artifact/com.isxcode.acorn/acorn-common)

```xml
<dependency>
    <groupId>com.isxcode.acorn</groupId>
    <artifactId>acorn-client</artifactId>
    <version>1.2.0</version>
</dependency>
```

###### 配置服务

```yaml
acorn:
  check-servers: true
  servers:
    default:
      host: isxcode
      port: 30155
      key: acorn-key
```

##### 插件使用

```java
package com.isxcode.acorn.demo;

import com.isxcode.acorn.client.template.AcornTemplate;
import com.isxcode.acorn.common.pojo.AcornResponse;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RequestMapping
@RestController
@SpringBootApplication
@RequiredArgsConstructor
public class DemoApplication {

    private final AcornTemplate acornTemplate;

    public static void main(String[] args) {

        SpringApplication.run(DemoApplication.class, args);
    }

    @GetMapping("/execute")
    public AcornResponse executeFlinkSql() {

        String flinkSql = "" +
            "CREATE TABLE from_table(\n" +
            "    username STRING,\n" +
            "    age INT\n" +
            ") WITH (\n" +
            "    'connector'='jdbc',\n" +
            "    'url'='jdbc:mysql://isxcode:30306/ispong_db',\n" +
            "    'table-name'='users',\n" +
            "    'driver'='com.mysql.cj.jdbc.Driver',\n" +
            "    'username'='root',\n" +
            "    'password'='ispong123');" +
            "" +
            "CREATE TABLE to_table(\n" +
            "    username STRING,\n" +
            "    age INT\n" +
            ") WITH (\n" +
            "    'connector'='jdbc',\n" +
            "    'url'='jdbc:mysql://isxcode:30306/ispong_db',\n" +
            "    'table-name'='users_sink',\n" +
            "    'driver'='com.mysql.cj.jdbc.Driver',\n" +
            "    'username'='root',\n" +
            "    'password'='ispong123');" +
            "" +
            "insert into to_table select username, age from from_table";

        return acornTemplate.build().sql(flinkSql).deploy();
    }
}
```

> 项目启动日志

```log

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v2.7.5)

2022-11-09 15:26:13.583  INFO 15476 --- [           main] com.isxcode.acorn.demo.DemoApplication   : Starting DemoApplication using Java 17.0.4.1 on DESKTOP-P620CAM with PID 15476 (D:\isxcode\flink-acorn\examples\acorn-demo\target\classes started by ispon in D:\isxcode\flink-acorn)
2022-11-09 15:26:13.586  INFO 15476 --- [           main] com.isxcode.acorn.demo.DemoApplication   : No active profile set, falling back to 1 default profile: "default"
2022-11-09 15:26:14.296  INFO 15476 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)
2022-11-09 15:26:14.304  INFO 15476 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2022-11-09 15:26:14.304  INFO 15476 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.68]
2022-11-09 15:26:14.375  INFO 15476 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2022-11-09 15:26:14.376  INFO 15476 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 731 ms
=================检查节点=======================
default:isxcode:[ok]
==============================================
2022-11-09 15:26:15.138  INFO 15476 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path ''
2022-11-09 15:26:15.145  INFO 15476 --- [           main] com.isxcode.acorn.demo.DemoApplication   : Started DemoApplication in 1.917 seconds (JVM running for 2.421)
```

###### 返回成功

> 提交成功，返回yarn的applicationId

```json
{
    "code":"200",
    "message":"操作成功",
    "acornData":{
        "applicationId":"application_1667964484125_0003",
        "flinkJobId": "f3d62bc20a7a7a075ecd9d5e0f8ed458"
    }
}
```

![20221109174510](https://img.isxcode.com/picgo/20221109174510.png)
